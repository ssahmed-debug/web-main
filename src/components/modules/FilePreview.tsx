import Image from "next/image";
import { IoMdClose } from "react-icons/io";
import { RiSendPlaneFill } from "react-icons/ri";
import { MdAttachFile, MdPictureAsPdf, MdDescription } from "react-icons/md";
import { BsFileEarmarkText, BsFileEarmarkZip } from "react-icons/bs";
import { useState } from "react";

interface FilePreviewProps {\n  file: File;\n  previewUrl: string | null;\n  text: string;\n  setText: (text: string) => void;\n  onSend: () => void;\n  onCancel: () => void;\n  isUploading: boolean;\n  uploadProgress: number;\n}\n\nconst FilePreview = ({\n  file,\n  previewUrl,\n  text,\n  setText,\n  onSend,\n  onCancel,\n  isUploading,\n  uploadProgress,\n}: FilePreviewProps) => {\n  const [imageLoaded, setImageLoaded] = useState(false);\n\n  const getFileIcon = () => {\n    const ext = file.name.split('.').pop()?.toLowerCase();\n    if (ext === 'pdf') return <MdPictureAsPdf className=\"size-16 text-red-500\" />;\n    if (['doc', 'docx'].includes(ext || '')) return <MdDescription className=\"size-16 text-blue-500\" />;\n    if (['txt', 'rtf'].includes(ext || '')) return <BsFileEarmarkText className=\"size-16 text-green-500\" />;\n    if (['zip', 'rar', '7z'].includes(ext || '')) return <BsFileEarmarkZip className=\"size-16 text-orange-500\" />;\n    return <MdAttachFile className=\"size-16 text-lightBlue\" />;\n  };\n\n  const formatFileSize = (bytes: number) => {\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    if (bytes === 0) return '0 B';\n    const i = Math.floor(Math.log(bytes) / Math.log(1024));\n    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/95 z-50 flex flex-col\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 bg-gradient-to-r from-darkBlue to-lightBlue\">\n        <button\n          onClick={onCancel}\n          className=\"text-white p-2 hover:bg-white/10 rounded-full transition-all\"\n          disabled={isUploading}\n        >\n          <IoMdClose className=\"size-6\" />\n        </button>\n        <div className=\"text-center text-white\">\n          <h3 className=\"font-bold\">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù</h3>\n          <p className=\"text-sm opacity-80\">{file.name}</p>\n        </div>\n        <div className=\"w-10\"></div>\n      </div>\n\n      {/* Progress Bar */}\n      {isUploading && (\n        <div className=\"px-4 py-2 bg-darkBlue/50\">\n          <div className=\"w-full bg-gray-700 rounded-full h-2\">\n            <div\n              className=\"bg-gradient-to-r from-lightBlue to-green-500 h-2 rounded-full transition-all duration-300\"\n              style={{ width: `${uploadProgress}%` }}\n            />\n          </div>\n          <p className=\"text-xs text-white text-center mt-1\">\n            Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹... {uploadProgress}%\n          </p>\n        </div>\n      )}\n\n      {/* Preview Content */}\n      <div className=\"flex-1 overflow-auto flex items-center justify-center p-4\">\n        <div className=\"max-w-4xl w-full\">\n          {file.type.startsWith('image/') && previewUrl ? (\n            <div className=\"relative\">\n              {!imageLoaded && (\n                <div className=\"bg-gray-800 animate-pulse h-96 rounded-lg flex items-center justify-center\">\n                  <span className=\"text-gray-400\">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>\n                </div>\n              )}\n              <Image\n                src={previewUrl}\n                alt=\"Preview\"\n                width={800}\n                height={600}\n                className={`w-full h-auto object-contain rounded-lg shadow-2xl ${\n                  imageLoaded ? 'block' : 'hidden'\n                }`}\n                onLoad={() => setImageLoaded(true)}\n                priority\n              />\n            </div>\n          ) : file.type.startsWith('video/') && previewUrl ? (\n            <video\n              src={previewUrl}\n              controls\n              className=\"w-full max-h-96 rounded-lg shadow-2xl\"\n              preload=\"metadata\"\n            />\n          ) : file.type.startsWith('audio/') && previewUrl ? (\n            <div className=\"bg-gradient-to-br from-purple-900 to-blue-900 p-8 rounded-xl shadow-2xl max-w-md mx-auto\">\n              <div className=\"text-center mb-6\">\n                <div className=\"w-20 h-20 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <span className=\"text-3xl\">ğŸµ</span>\n                </div>\n                <h3 className=\"text-white font-bold text-lg truncate\">{file.name}</h3>\n                <p className=\"text-purple-200 text-sm\">{formatFileSize(file.size)}</p>\n              </div>\n              <audio\n                src={previewUrl}\n                controls\n                className=\"w-full\"\n                preload=\"metadata\"\n              />\n            </div>\n          ) : (\n            // Other file types\n            <div className=\"bg-gradient-to-br from-darkBlue to-gray-800 p-8 rounded-xl shadow-2xl max-w-md mx-auto text-center\">\n              <div className=\"mb-6\">\n                {getFileIcon()}\n              </div>\n              <h3 className=\"text-white font-bold text-lg mb-2 break-all\">\n                {file.name}\n              </h3>\n              <p className=\"text-gray-300 text-sm mb-4\">\n                {formatFileSize(file.size)}\n              </p>\n              <div className=\"bg-white/10 rounded-lg p-3\">\n                <p className=\"text-white/80 text-xs\">\n                  Ø³ÙŠØªÙ… Ø±ÙØ¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ ÙƒÙ…Ø±ÙÙ‚\n                </p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Caption Input */}\n      <div className=\"bg-leftBarBg p-4 border-t border-gray-700\">\n        {isUploading ? (\n          <div className=\"text-center text-white/60\">\n            <p>Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>\n          </div>\n        ) : (\n          <div className=\"flex items-center gap-3\">\n            <input\n              type=\"text\"\n              value={text}\n              onChange={(e) => setText(e.target.value)}\n              placeholder=\"Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)...\"\n              className=\"flex-1 bg-chatBg text-white rounded-full px-4 py-3 text-sm outline-none border border-gray-600 focus:border-lightBlue transition-colors\"\n              disabled={isUploading}\n              autoFocus\n            />\n            <button\n              onClick={onSend}\n              disabled={isUploading}\n              className=\"bg-gradient-to-r from-lightBlue to-blue-600 text-white p-3 rounded-full hover:from-blue-600 hover:to-lightBlue transition-all transform hover:scale-105 disabled:opacity-50 disabled:transform-none\"\n            >\n              <RiSendPlaneFill className=\"size-5\" />\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default FilePreview;